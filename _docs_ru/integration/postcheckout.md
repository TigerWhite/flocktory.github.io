---
layout: doc
title:  "Postcheckout"
section: integration
---
Внимание! Перед подключением модуля Postcheckout необходимо произвести [общую интеграцию]({{ site.baseurl }}{% link _docs_ru/integration/general.md %})

Данный код требуется разместить на странице успешного оформления заказа.

Если у вас несколько различных страниц успешно оформленного заказа — необходимо разместить код на каждой такой странице. Код интеграции должны сформировать на сервере ваши программисты (например, при помощи Java/Ruby/PHP/Perl).

```html
<script type="text/javascript">
    window.flocktory = window.flocktory || [];
    window.flocktory.push(['postcheckout', {
        user: {
            name: 'Ivan Ivanov',
            email: 'ivan@gmail.com',
            sex: 'm',
        },
        order: {
            id: '77',
            price: 2000,
            custom_field: 'my_custom_id',
            items: [{
                id: '777',
                title: 'Nike Shoes',
                price: 1000,
                image: 'http://path.to.image',
                count: 1
            }]
        }, spot:'desktop'
    }]);
</script>
```

## Параметры кода интеграции
Код интеграции включает как обязательные, так и опциональные параметры. С технической точки зрения, нам достаточно лишь первых, но чем точнее и полнее переданные нам данные, тем лучше сможет работать наш рекомендательный сервис. Пожалуйста, старайтесь указывать как можно больше параметров.

### Обязательные параметры

#### user → name
Полное имя пользователя. Например: Ivan Ivanov. Пожалуйста, передавайте нам имя пользователя как можно точнее. Персонализация элементов сильно влияет на конверсии.

#### user → email
Email пользователя. Благодаря этому параметру мы понимаем, кто есть кто. Если вы по каким-то причинам не знаете email пользователя, но знаете его телефон, достаточно передать его в формате phone_number@unknown.email. Скорее всего, этот пользователь уже есть в нашей базе, и мы сможем обогатить ваши данные.
Если вы ничего не знаете о пользователе, передайте этот параметр в формате id@unknown.email, где id — идентификатор пользователя в вашей системе.

#### order → id
Идентификатор заказа покупателя. Каждый идентификатор заказа должен быть уникальным.

#### order → price
Полная стоимость корзины. Например: 2999,99 или 1000.00. Полная стоимость передается без указания валюты и без пробелов. В качестве разделителя дробных можно использовать как точку, так и запятую.

#### order → items
Корзина товаров на момент покупки. На основе этих данных работают различные фильтры для кампаний, сегментации и рекомендации. Пожалуйста, аккуратно передавайте нам все параметры.
Набор товаров передается как Array в JavaScript.


### Опциональные (необязательные) параметры

#### user → sex
Пол пользователя.
Возможные значения: m и f (для male и female соответственно). Если вы не знаете пол вашего пользователя, не передавайте его нам, мы сами умеем его определять..

#### order → custom_field
Дополнительный идентификатор заказа.
Передается на ваше усмотрение. Если вы не понимаете зачем это, просто не передавайте нам этот параметр..

#### order → items → id
Артикул товара, уникальный для вашего магазина.
На основе артикула мы пытаемся определить уникальные товары, а также найти для них описание и категорию..

#### order → items → price
Стоимость товара.
Передавая нам честную цену товара, вы сможете использовать это в сегментации кампаний. Это необязательный параметр, но он важен для работы нашего Data Department..

#### order → items → title
Название товара.
Product Name.

#### order → items → image
Изображение товара.
URL картинки товара. Его можно использовать для постинга изображения в соцсети..

#### order → items → count
Количество данных товаров в корзине покупателя.
Этот параметр лучше указать, если у вас покупают одного наименования больше, чем один раз. Во-первых, мы лучше поймем предпочтения пользователей, а во-вторых — сможем настроить кампании специально для данной аудитории..

#### spot
Внутренний фильтр кампаний.
Спот — это специальный идентификатор, с помощью которого вы можете сегментировать кампании на основе вашей внутренний логики. К примеру, у вас есть несколько различных страниц «Спасибо за покупку», и вы хотите показывать для них различные кампании. Задавая в коде интеграции определенный спот, вы настраиваете показ определенных кампаний для данного конкретного кода интеграции.
Если нет необходимости фильтровать кампании подобным образом, не передавайте в коде этот параметр.

## На что обратить внимание

*	Код интеграции должен быть размещен на странице успешного оформления заказа (страница “Спасибо”) или на всех таких страницах, при разных способах оплаты, доставки и т.п., а также при оформлении быстрого заказа.
*	Должны быть переданы обязательные параметры:
    * Данные пользователя (user):
    * e-mail;
    * имя (в порядке “Имя Фамилия”, если есть фамилия);

* Если нет имени, необходимо оставлять параметр пустым.
* Если нет e-mail:
* если известен номер телефона, нужно передавать в виде phone_number@unknown.email ( например, 79998887766@unknown.email ).
    * если пользователь авторизуется, но нет ни почты, ни телефона, должно передаваться user_id + @unknown.email, где user_id – идентификатор пользователя в вашей системе (например, 12345678@unknown.email).
* Данные заказа (order):
    * Id товаров должны соответствовать yml фиду.
    * Названия товаров должны быть понятными клиенту.
    * Если в названии присутствуют кавычки, необходимо их экранировать, либо заменить на тип кавычек, отличный от используемых в javascript коде.



# Интеграция модуля Postcheckout через GTM

1) В разделе "Variables" создайте все переменные, которые вам понадобятся в коде. Они должны ссылаться на какие-либо ресурсы на самой странице. Например, на глобальные JS переменные, переменные в DataLayer. Также можно указать функцию, которая будет возвращать значение переменной. Это зависит от структуры самого сайта и способа хранения данных. На примере создается переменная, привязанная к глобальной JS переменной.

![](https://assets.flocktory.com/uploads/clients/1791/303cacce-fdb8-49d2-86df-ee5e02992786_image14.png)

Набор переменных может отличаться от показанного здесь в соответствии с тем, как данные хранятся на сайте

![](https://assets.flocktory.com/uploads/clients/1791/d826d6e3-19b3-4fc6-9370-9ca69b5b1a6b_image15.png)

2) Создайте триггер, который будет срабатывать на TY-page. Для этого можно использовать, например, URL страницы, событие (custom event), значение переменной.

![](https://assets.flocktory.com/uploads/clients/1791/a4b66254-91c9-4af7-96b7-99eb3cf823b9_image16.png)

3) В разделе "Tags" создайте тег с трекинг кодом, приведенным выше. Подставьте переменные так, чтобы при запуске тега структура и типы данных соответствовали указанной структуре. Если вы используете spot или custom field, можно так же подставлять их значения из переменных.

![](https://assets.flocktory.com/uploads/clients/1791/84ff1cf0-9895-4a60-bb9d-135ce9c2fa83_image17.png)
